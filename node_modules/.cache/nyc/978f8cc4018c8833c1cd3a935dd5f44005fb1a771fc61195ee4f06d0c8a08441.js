var cov_1ugttkxrge=function(){var path="C:\\poly\\LOG4420\\TP3\\TP3_4420A\\services\\mongo\\seminar.js";var hash="c001810b580150381427728a54f139d46ac4f029";var Function=function(){}.constructor;var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\poly\\LOG4420\\TP3\\TP3_4420A\\services\\mongo\\seminar.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:32}},"1":{start:{line:2,column:27},end:{line:2,column:46}},"2":{start:{line:21,column:20},end:{line:47,column:1}},"3":{start:{line:21,column:26},end:{line:47,column:1}},"4":{start:{line:21,column:35},end:{line:47,column:1}},"5":{start:{line:21,column:47},end:{line:47,column:1}},"6":{start:{line:23,column:2},end:{line:46,column:5}},"7":{start:{line:24,column:4},end:{line:45,column:5}},"8":{start:{line:24,column:13},end:{line:24,column:32}},"9":{start:{line:26,column:23},end:{line:40,column:10}},"10":{start:{line:28,column:34},end:{line:28,column:67}},"11":{start:{line:29,column:40},end:{line:29,column:79}},"12":{start:{line:30,column:26},end:{line:30,column:72}},"13":{start:{line:31,column:35},end:{line:31,column:86}},"14":{start:{line:32,column:10},end:{line:39,column:11}},"15":{start:{line:42,column:30},end:{line:42,column:84}},"16":{start:{line:43,column:34},end:{line:43,column:86}},"17":{start:{line:43,column:69},end:{line:43,column:75}},"18":{start:{line:44,column:6},end:{line:44,column:41}},"19":{start:{line:58,column:33},end:{line:64,column:1}},"20":{start:{line:58,column:42},end:{line:64,column:1}},"21":{start:{line:59,column:2},end:{line:63,column:3}},"22":{start:{line:60,column:4},end:{line:60,column:52}},"23":{start:{line:60,column:32},end:{line:60,column:51}},"24":{start:{line:62,column:4},end:{line:62,column:19}},"25":{start:{line:75,column:21},end:{line:85,column:1}},"26":{start:{line:75,column:30},end:{line:85,column:1}},"27":{start:{line:76,column:25},end:{line:79,column:63}},"28":{start:{line:80,column:2},end:{line:84,column:3}},"29":{start:{line:81,column:4},end:{line:81,column:91}},"30":{start:{line:81,column:37},end:{line:81,column:90}},"31":{start:{line:83,column:4},end:{line:83,column:19}},"32":{start:{line:95,column:16},end:{line:103,column:1}},"33":{start:{line:95,column:25},end:{line:103,column:1}},"34":{start:{line:95,column:31},end:{line:103,column:1}},"35":{start:{line:96,column:2},end:{line:102,column:3}},"36":{start:{line:97,column:4},end:{line:97,column:43}},"37":{start:{line:98,column:9},end:{line:102,column:3}},"38":{start:{line:99,column:4},end:{line:99,column:43}},"39":{start:{line:101,column:4},end:{line:101,column:12}},"40":{start:{line:105,column:0},end:{line:109,column:1}},"41":{start:{line:106,column:2},end:{line:108,column:3}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:21,column:20},end:{line:21,column:21}},loc:{start:{line:21,column:26},end:{line:47,column:1}},line:21},"1":{name:"(anonymous_1)",decl:{start:{line:21,column:26},end:{line:21,column:27}},loc:{start:{line:21,column:35},end:{line:47,column:1}},line:21},"2":{name:"(anonymous_2)",decl:{start:{line:21,column:35},end:{line:21,column:36}},loc:{start:{line:21,column:47},end:{line:47,column:1}},line:21},"3":{name:"(anonymous_3)",decl:{start:{line:21,column:47},end:{line:21,column:48}},loc:{start:{line:21,column:59},end:{line:47,column:1}},line:21},"4":{name:"(anonymous_4)",decl:{start:{line:23,column:45},end:{line:23,column:46}},loc:{start:{line:23,column:67},end:{line:46,column:3}},line:23},"5":{name:"(anonymous_5)",decl:{start:{line:27,column:13},end:{line:27,column:14}},loc:{start:{line:27,column:18},end:{line:40,column:9}},line:27},"6":{name:"(anonymous_6)",decl:{start:{line:43,column:57},end:{line:43,column:58}},loc:{start:{line:43,column:69},end:{line:43,column:75}},line:43},"7":{name:"(anonymous_7)",decl:{start:{line:58,column:33},end:{line:58,column:34}},loc:{start:{line:58,column:42},end:{line:64,column:1}},line:58},"8":{name:"(anonymous_8)",decl:{start:{line:58,column:42},end:{line:58,column:43}},loc:{start:{line:58,column:54},end:{line:64,column:1}},line:58},"9":{name:"(anonymous_9)",decl:{start:{line:60,column:27},end:{line:60,column:28}},loc:{start:{line:60,column:32},end:{line:60,column:51}},line:60},"10":{name:"(anonymous_10)",decl:{start:{line:75,column:21},end:{line:75,column:22}},loc:{start:{line:75,column:30},end:{line:85,column:1}},line:75},"11":{name:"(anonymous_11)",decl:{start:{line:75,column:30},end:{line:75,column:31}},loc:{start:{line:75,column:42},end:{line:85,column:1}},line:75},"12":{name:"(anonymous_12)",decl:{start:{line:81,column:25},end:{line:81,column:26}},loc:{start:{line:81,column:37},end:{line:81,column:90}},line:81},"13":{name:"(anonymous_13)",decl:{start:{line:95,column:16},end:{line:95,column:17}},loc:{start:{line:95,column:25},end:{line:103,column:1}},line:95},"14":{name:"(anonymous_14)",decl:{start:{line:95,column:25},end:{line:95,column:26}},loc:{start:{line:95,column:31},end:{line:103,column:1}},line:95},"15":{name:"(anonymous_15)",decl:{start:{line:95,column:31},end:{line:95,column:32}},loc:{start:{line:95,column:37},end:{line:103,column:1}},line:95},"16":{name:"(anonymous_16)",decl:{start:{line:105,column:17},end:{line:105,column:18}},loc:{start:{line:105,column:23},end:{line:109,column:1}},line:105}},branchMap:{"0":{loc:{start:{line:24,column:4},end:{line:45,column:5}},type:"if",locations:[{start:{line:24,column:4},end:{line:45,column:5}},{start:{line:24,column:4},end:{line:45,column:5}}],line:24},"1":{loc:{start:{line:26,column:24},end:{line:26,column:55}},type:"cond-expr",locations:[{start:{line:26,column:44},end:{line:26,column:46}},{start:{line:26,column:49},end:{line:26,column:55}}],line:26},"2":{loc:{start:{line:59,column:2},end:{line:63,column:3}},type:"if",locations:[{start:{line:59,column:2},end:{line:63,column:3}},{start:{line:59,column:2},end:{line:63,column:3}}],line:59},"3":{loc:{start:{line:59,column:6},end:{line:59,column:53}},type:"binary-expr",locations:[{start:{line:59,column:6},end:{line:59,column:25}},{start:{line:59,column:29},end:{line:59,column:53}}],line:59},"4":{loc:{start:{line:76,column:25},end:{line:79,column:63}},type:"binary-expr",locations:[{start:{line:76,column:25},end:{line:76,column:44}},{start:{line:77,column:4},end:{line:77,column:28}},{start:{line:78,column:4},end:{line:78,column:34}},{start:{line:79,column:5},end:{line:79,column:31}},{start:{line:79,column:35},end:{line:79,column:62}}],line:76},"5":{loc:{start:{line:80,column:2},end:{line:84,column:3}},type:"if",locations:[{start:{line:80,column:2},end:{line:84,column:3}},{start:{line:80,column:2},end:{line:84,column:3}}],line:80},"6":{loc:{start:{line:96,column:2},end:{line:102,column:3}},type:"if",locations:[{start:{line:96,column:2},end:{line:102,column:3}},{start:{line:96,column:2},end:{line:102,column:3}}],line:96},"7":{loc:{start:{line:97,column:11},end:{line:97,column:43}},type:"cond-expr",locations:[{start:{line:97,column:23},end:{line:97,column:25}},{start:{line:97,column:28},end:{line:97,column:43}}],line:97},"8":{loc:{start:{line:97,column:28},end:{line:97,column:43}},type:"cond-expr",locations:[{start:{line:97,column:38},end:{line:97,column:39}},{start:{line:97,column:42},end:{line:97,column:43}}],line:97},"9":{loc:{start:{line:98,column:9},end:{line:102,column:3}},type:"if",locations:[{start:{line:98,column:9},end:{line:102,column:3}},{start:{line:98,column:9},end:{line:102,column:3}}],line:98},"10":{loc:{start:{line:99,column:11},end:{line:99,column:43}},type:"cond-expr",locations:[{start:{line:99,column:23},end:{line:99,column:24}},{start:{line:99,column:27},end:{line:99,column:43}}],line:99},"11":{loc:{start:{line:99,column:27},end:{line:99,column:43}},type:"cond-expr",locations:[{start:{line:99,column:37},end:{line:99,column:39}},{start:{line:99,column:42},end:{line:99,column:43}}],line:99}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const moment=(cov_1ugttkxrge.s[0]++,require('moment'));const{getTranslation}=(cov_1ugttkxrge.s[1]++,require('../utils'));/**
 * Fonction de rappel pour récupérer les séminaires
 *
 * @callback seminarCallback
 * @param {Error} err - Objet d'erreur
 * @param {Array} result - Séminaires
 */ /**
 *  Obtenir l'ensemble des séminaires.
 *
 *  @param db - Base de données Mongo
 *  @param {Object} query - Requête particulière sous le format suivant:
 *    { from: <DATE>, sort: { field: <string>, order: <ASC|DESC> } }
 *  @param {string} language - Langue courante (p.ex. 'fr', 'en', etc.)
 *  @param {seminarCallback} callback - Fonction de rappel pour obtenir le résultat
 */cov_1ugttkxrge.s[2]++;const getSeminars=db=>{cov_1ugttkxrge.f[0]++;cov_1ugttkxrge.s[3]++;return query=>{cov_1ugttkxrge.f[1]++;cov_1ugttkxrge.s[4]++;return language=>{cov_1ugttkxrge.f[2]++;cov_1ugttkxrge.s[5]++;return callback=>{cov_1ugttkxrge.f[3]++;cov_1ugttkxrge.s[6]++;// COMPLET
db.collection('seminars').find({}).toArray(function(err,result){cov_1ugttkxrge.f[4]++;cov_1ugttkxrge.s[7]++;if(err){cov_1ugttkxrge.b[0][0]++;cov_1ugttkxrge.s[8]++;callback(err,null);}else{cov_1ugttkxrge.b[0][1]++;const seminars=(cov_1ugttkxrge.s[9]++,(result===null?(cov_1ugttkxrge.b[1][0]++,[]):(cov_1ugttkxrge.b[1][1]++,result)).map(s=>{cov_1ugttkxrge.f[5]++;const translatedTitle=(cov_1ugttkxrge.s[10]++,getTranslation(language,s.title));const translatedDescription=(cov_1ugttkxrge.s[11]++,getTranslation(language,s.description));const newDate=(cov_1ugttkxrge.s[12]++,moment(s.date,'YYYY-MM-DD HH:mm:ss').toDate());const newCreatedAtDate=(cov_1ugttkxrge.s[13]++,moment(s.createdAt,'YYYY-MM-DD HH:mm:ss').toDate());cov_1ugttkxrge.s[14]++;return{...s,title:translatedTitle,description:translatedDescription,type:'seminar',date:newDate,createdAt:newCreatedAtDate};}));const transformations=(cov_1ugttkxrge.s[15]++,[filterSeminarsByFromDate(query),sortSeminars(query)]);const transformedSeminars=(cov_1ugttkxrge.s[16]++,transformations.reduce((acc,f)=>{cov_1ugttkxrge.f[6]++;cov_1ugttkxrge.s[17]++;return f(acc);},seminars));cov_1ugttkxrge.s[18]++;callback(null,transformedSeminars);}});};};};};/**
 *  Filtre les séminaires avant une date particulière.
 *
 *  Si la date n'est pas fournise, on renvoie le tableau initial.
 *
 *  @param {Object} query - Objet avec le champ 'query.from'
 *  @param {Array} seminars - Tableau de séminaires à filtrer
 *  @returns {Array} Tableau de séminaires potentiellement filtré
 */cov_1ugttkxrge.s[19]++;const filterSeminarsByFromDate=query=>{cov_1ugttkxrge.f[7]++;cov_1ugttkxrge.s[20]++;return seminars=>{cov_1ugttkxrge.f[8]++;cov_1ugttkxrge.s[21]++;if((cov_1ugttkxrge.b[3][0]++,query!==undefined)&&(cov_1ugttkxrge.b[3][1]++,query.from!==undefined)){cov_1ugttkxrge.b[2][0]++;cov_1ugttkxrge.s[22]++;return seminars.filter(s=>{cov_1ugttkxrge.f[9]++;cov_1ugttkxrge.s[23]++;return s.date>query.from;});}else{cov_1ugttkxrge.b[2][1]++;cov_1ugttkxrge.s[24]++;return seminars;}};};/**
 *  Trie les séminaires selon un champ et un ordre particulier.
 *
 *  Si le champ et/ou l'ordre n'est pas fournis, on renvoie le tableau initial.
 *
 *  @param {Object} query - Objet avec le champ 'query.sort.field' et 'query.sort.order'
 *  @param {Array} seminars - Tableau de séminaires à filtrer
 *  @returns {Array} Tableau de séminaires potentiellement trié
 */cov_1ugttkxrge.s[25]++;const sortSeminars=query=>{cov_1ugttkxrge.f[10]++;cov_1ugttkxrge.s[26]++;return seminars=>{cov_1ugttkxrge.f[11]++;const canSortByField=(cov_1ugttkxrge.s[27]++,(cov_1ugttkxrge.b[4][0]++,query!==undefined)&&(cov_1ugttkxrge.b[4][1]++,query.sort!==undefined)&&(cov_1ugttkxrge.b[4][2]++,query.sort.field!==undefined)&&((cov_1ugttkxrge.b[4][3]++,query.sort.order==='ASC')||(cov_1ugttkxrge.b[4][4]++,query.sort.order==='DESC')));cov_1ugttkxrge.s[28]++;if(canSortByField){cov_1ugttkxrge.b[5][0]++;cov_1ugttkxrge.s[29]++;return seminars.sort((s1,s2)=>{cov_1ugttkxrge.f[12]++;cov_1ugttkxrge.s[30]++;return compare(query.sort.order)(s1.createdAt)(s2.createdAt);});}else{cov_1ugttkxrge.b[5][1]++;cov_1ugttkxrge.s[31]++;return seminars;}};};/**
 *  Fonction de comparaison entre deux valeurs et un ordre.
 *
 *  @param {string} order - Valeurs ASC ou DESC
 *  @param v1 - Première valeur
 *  @param v2 - Deuxième valeur
 *  @returns {int} Valeur de -1, 0 ou 1 selon le paramètre order
 */cov_1ugttkxrge.s[32]++;const compare=order=>{cov_1ugttkxrge.f[13]++;cov_1ugttkxrge.s[33]++;return v1=>{cov_1ugttkxrge.f[14]++;cov_1ugttkxrge.s[34]++;return v2=>{cov_1ugttkxrge.f[15]++;cov_1ugttkxrge.s[35]++;if(order==='ASC'){cov_1ugttkxrge.b[6][0]++;cov_1ugttkxrge.s[36]++;return v1<v2?(cov_1ugttkxrge.b[7][0]++,-1):(cov_1ugttkxrge.b[7][1]++,v1>v2?(cov_1ugttkxrge.b[8][0]++,1):(cov_1ugttkxrge.b[8][1]++,0));}else{cov_1ugttkxrge.b[6][1]++;cov_1ugttkxrge.s[37]++;if(order==='DESC'){cov_1ugttkxrge.b[9][0]++;cov_1ugttkxrge.s[38]++;return v1<v2?(cov_1ugttkxrge.b[10][0]++,1):(cov_1ugttkxrge.b[10][1]++,v1>v2?(cov_1ugttkxrge.b[11][0]++,-1):(cov_1ugttkxrge.b[11][1]++,0));}else{cov_1ugttkxrge.b[9][1]++;cov_1ugttkxrge.s[39]++;return 0;}}};};};cov_1ugttkxrge.s[40]++;module.exports=db=>{cov_1ugttkxrge.f[16]++;cov_1ugttkxrge.s[41]++;return{getSeminars:getSeminars(db)};};