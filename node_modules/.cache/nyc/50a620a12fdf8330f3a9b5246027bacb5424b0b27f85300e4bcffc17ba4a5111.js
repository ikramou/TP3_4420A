var cov_1lkuiw17pf=function(){var path="/Users/ikram/Documents/TP3_4420A/services/yaml/seminar.js";var hash="670bfdbc543cd7e88dc46270997f5b95065635e8";var Function=function(){}.constructor;var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/ikram/Documents/TP3_4420A/services/yaml/seminar.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:31}},"1":{start:{line:2,column:15},end:{line:2,column:32}},"2":{start:{line:3,column:27},end:{line:3,column:46}},"3":{start:{line:22,column:20},end:{line:49,column:1}},"4":{start:{line:22,column:26},end:{line:49,column:1}},"5":{start:{line:22,column:35},end:{line:49,column:1}},"6":{start:{line:22,column:47},end:{line:49,column:1}},"7":{start:{line:23,column:2},end:{line:48,column:4}},"8":{start:{line:24,column:4},end:{line:47,column:5}},"9":{start:{line:25,column:6},end:{line:25,column:25}},"10":{start:{line:27,column:29},end:{line:27,column:51}},"11":{start:{line:28,column:23},end:{line:42,column:10}},"12":{start:{line:30,column:34},end:{line:30,column:67}},"13":{start:{line:31,column:40},end:{line:31,column:79}},"14":{start:{line:32,column:26},end:{line:32,column:72}},"15":{start:{line:33,column:35},end:{line:33,column:86}},"16":{start:{line:34,column:10},end:{line:41,column:11}},"17":{start:{line:44,column:30},end:{line:44,column:84}},"18":{start:{line:45,column:34},end:{line:45,column:86}},"19":{start:{line:45,column:69},end:{line:45,column:75}},"20":{start:{line:46,column:6},end:{line:46,column:41}},"21":{start:{line:60,column:33},end:{line:66,column:1}},"22":{start:{line:60,column:42},end:{line:66,column:1}},"23":{start:{line:61,column:2},end:{line:65,column:3}},"24":{start:{line:62,column:4},end:{line:62,column:52}},"25":{start:{line:62,column:32},end:{line:62,column:51}},"26":{start:{line:64,column:4},end:{line:64,column:19}},"27":{start:{line:77,column:21},end:{line:87,column:1}},"28":{start:{line:77,column:30},end:{line:87,column:1}},"29":{start:{line:78,column:25},end:{line:81,column:63}},"30":{start:{line:82,column:2},end:{line:86,column:3}},"31":{start:{line:83,column:4},end:{line:83,column:81}},"32":{start:{line:83,column:37},end:{line:83,column:80}},"33":{start:{line:85,column:4},end:{line:85,column:19}},"34":{start:{line:97,column:16},end:{line:105,column:1}},"35":{start:{line:97,column:25},end:{line:105,column:1}},"36":{start:{line:97,column:31},end:{line:105,column:1}},"37":{start:{line:98,column:2},end:{line:104,column:3}},"38":{start:{line:99,column:4},end:{line:99,column:43}},"39":{start:{line:100,column:9},end:{line:104,column:3}},"40":{start:{line:101,column:4},end:{line:101,column:43}},"41":{start:{line:103,column:4},end:{line:103,column:12}},"42":{start:{line:107,column:0},end:{line:111,column:1}},"43":{start:{line:108,column:2},end:{line:110,column:3}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:22,column:20},end:{line:22,column:21}},loc:{start:{line:22,column:26},end:{line:49,column:1}},line:22},"1":{name:"(anonymous_1)",decl:{start:{line:22,column:26},end:{line:22,column:27}},loc:{start:{line:22,column:35},end:{line:49,column:1}},line:22},"2":{name:"(anonymous_2)",decl:{start:{line:22,column:35},end:{line:22,column:36}},loc:{start:{line:22,column:47},end:{line:49,column:1}},line:22},"3":{name:"(anonymous_3)",decl:{start:{line:22,column:47},end:{line:22,column:48}},loc:{start:{line:22,column:59},end:{line:49,column:1}},line:22},"4":{name:"(anonymous_4)",decl:{start:{line:23,column:45},end:{line:23,column:46}},loc:{start:{line:23,column:63},end:{line:48,column:3}},line:23},"5":{name:"(anonymous_5)",decl:{start:{line:29,column:13},end:{line:29,column:14}},loc:{start:{line:29,column:18},end:{line:42,column:9}},line:29},"6":{name:"(anonymous_6)",decl:{start:{line:45,column:57},end:{line:45,column:58}},loc:{start:{line:45,column:69},end:{line:45,column:75}},line:45},"7":{name:"(anonymous_7)",decl:{start:{line:60,column:33},end:{line:60,column:34}},loc:{start:{line:60,column:42},end:{line:66,column:1}},line:60},"8":{name:"(anonymous_8)",decl:{start:{line:60,column:42},end:{line:60,column:43}},loc:{start:{line:60,column:54},end:{line:66,column:1}},line:60},"9":{name:"(anonymous_9)",decl:{start:{line:62,column:27},end:{line:62,column:28}},loc:{start:{line:62,column:32},end:{line:62,column:51}},line:62},"10":{name:"(anonymous_10)",decl:{start:{line:77,column:21},end:{line:77,column:22}},loc:{start:{line:77,column:30},end:{line:87,column:1}},line:77},"11":{name:"(anonymous_11)",decl:{start:{line:77,column:30},end:{line:77,column:31}},loc:{start:{line:77,column:42},end:{line:87,column:1}},line:77},"12":{name:"(anonymous_12)",decl:{start:{line:83,column:25},end:{line:83,column:26}},loc:{start:{line:83,column:37},end:{line:83,column:80}},line:83},"13":{name:"(anonymous_13)",decl:{start:{line:97,column:16},end:{line:97,column:17}},loc:{start:{line:97,column:25},end:{line:105,column:1}},line:97},"14":{name:"(anonymous_14)",decl:{start:{line:97,column:25},end:{line:97,column:26}},loc:{start:{line:97,column:31},end:{line:105,column:1}},line:97},"15":{name:"(anonymous_15)",decl:{start:{line:97,column:31},end:{line:97,column:32}},loc:{start:{line:97,column:37},end:{line:105,column:1}},line:97},"16":{name:"(anonymous_16)",decl:{start:{line:107,column:17},end:{line:107,column:18}},loc:{start:{line:107,column:23},end:{line:111,column:1}},line:107}},branchMap:{"0":{loc:{start:{line:24,column:4},end:{line:47,column:5}},type:"if",locations:[{start:{line:24,column:4},end:{line:47,column:5}},{start:{line:24,column:4},end:{line:47,column:5}}],line:24},"1":{loc:{start:{line:28,column:24},end:{line:28,column:71}},type:"cond-expr",locations:[{start:{line:28,column:52},end:{line:28,column:54}},{start:{line:28,column:57},end:{line:28,column:71}}],line:28},"2":{loc:{start:{line:61,column:2},end:{line:65,column:3}},type:"if",locations:[{start:{line:61,column:2},end:{line:65,column:3}},{start:{line:61,column:2},end:{line:65,column:3}}],line:61},"3":{loc:{start:{line:61,column:6},end:{line:61,column:53}},type:"binary-expr",locations:[{start:{line:61,column:6},end:{line:61,column:25}},{start:{line:61,column:29},end:{line:61,column:53}}],line:61},"4":{loc:{start:{line:78,column:25},end:{line:81,column:63}},type:"binary-expr",locations:[{start:{line:78,column:25},end:{line:78,column:44}},{start:{line:79,column:4},end:{line:79,column:28}},{start:{line:80,column:4},end:{line:80,column:34}},{start:{line:81,column:5},end:{line:81,column:31}},{start:{line:81,column:35},end:{line:81,column:62}}],line:78},"5":{loc:{start:{line:82,column:2},end:{line:86,column:3}},type:"if",locations:[{start:{line:82,column:2},end:{line:86,column:3}},{start:{line:82,column:2},end:{line:86,column:3}}],line:82},"6":{loc:{start:{line:98,column:2},end:{line:104,column:3}},type:"if",locations:[{start:{line:98,column:2},end:{line:104,column:3}},{start:{line:98,column:2},end:{line:104,column:3}}],line:98},"7":{loc:{start:{line:99,column:11},end:{line:99,column:43}},type:"cond-expr",locations:[{start:{line:99,column:23},end:{line:99,column:25}},{start:{line:99,column:28},end:{line:99,column:43}}],line:99},"8":{loc:{start:{line:99,column:28},end:{line:99,column:43}},type:"cond-expr",locations:[{start:{line:99,column:38},end:{line:99,column:39}},{start:{line:99,column:42},end:{line:99,column:43}}],line:99},"9":{loc:{start:{line:100,column:9},end:{line:104,column:3}},type:"if",locations:[{start:{line:100,column:9},end:{line:104,column:3}},{start:{line:100,column:9},end:{line:104,column:3}}],line:100},"10":{loc:{start:{line:101,column:11},end:{line:101,column:43}},type:"cond-expr",locations:[{start:{line:101,column:23},end:{line:101,column:24}},{start:{line:101,column:27},end:{line:101,column:43}}],line:101},"11":{loc:{start:{line:101,column:27},end:{line:101,column:43}},type:"cond-expr",locations:[{start:{line:101,column:37},end:{line:101,column:39}},{start:{line:101,column:42},end:{line:101,column:43}}],line:101}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const yaml=(cov_1lkuiw17pf.s[0]++,require('js-yaml'));const moment=(cov_1lkuiw17pf.s[1]++,require('moment'));const{getTranslation}=(cov_1lkuiw17pf.s[2]++,require('../utils'));/**
 * Fonction de rappel pour récupérer les séminaires
 *
 * @callback seminarCallback
 * @param {Error} err - Objet d'erreur
 * @param {Array} result - Séminaires
 */ /**
 *  Obtenir l'ensemble des séminaires.
 *
 *  @param fs - Système de fichier
 *  @param {Object} query - Requête particulière sous le format suivant:
 *    { from: <DATE>, sort: { field: <string>, order: <ASC|DESC> } }
 *  @param {string} language - Langue courante (p.ex. 'fr', 'en', etc.)
 *  @param {seminarCallback} callback - Fonction de rappel pour obtenir le résultat
 */cov_1lkuiw17pf.s[3]++;const getSeminars=fs=>{cov_1lkuiw17pf.f[0]++;cov_1lkuiw17pf.s[4]++;return query=>{cov_1lkuiw17pf.f[1]++;cov_1lkuiw17pf.s[5]++;return language=>{cov_1lkuiw17pf.f[2]++;cov_1lkuiw17pf.s[6]++;return callback=>{cov_1lkuiw17pf.f[3]++;cov_1lkuiw17pf.s[7]++;fs.readFile('./data/seminars.yml','utf8',(err,content)=>{cov_1lkuiw17pf.f[4]++;cov_1lkuiw17pf.s[8]++;if(err){cov_1lkuiw17pf.b[0][0]++;cov_1lkuiw17pf.s[9]++;callback(err,null);}else{cov_1lkuiw17pf.b[0][1]++;const yamlContentOpt=(cov_1lkuiw17pf.s[10]++,yaml.safeLoad(content));const seminars=(cov_1lkuiw17pf.s[11]++,(yamlContentOpt===null?(cov_1lkuiw17pf.b[1][0]++,[]):(cov_1lkuiw17pf.b[1][1]++,yamlContentOpt)).map(s=>{cov_1lkuiw17pf.f[5]++;const translatedTitle=(cov_1lkuiw17pf.s[12]++,getTranslation(language,s.title));const translatedDescription=(cov_1lkuiw17pf.s[13]++,getTranslation(language,s.description));const newDate=(cov_1lkuiw17pf.s[14]++,moment(s.date,'YYYY-MM-DD HH:mm:ss').toDate());const newCreatedAtDate=(cov_1lkuiw17pf.s[15]++,moment(s.createdAt,'YYYY-MM-DD HH:mm:ss').toDate());cov_1lkuiw17pf.s[16]++;return{...s,title:translatedTitle,description:translatedDescription,type:'seminar',date:newDate,createdAt:newCreatedAtDate};}));const transformations=(cov_1lkuiw17pf.s[17]++,[filterSeminarsByFromDate(query),sortSeminars(query)]);const transformedSeminars=(cov_1lkuiw17pf.s[18]++,transformations.reduce((acc,f)=>{cov_1lkuiw17pf.f[6]++;cov_1lkuiw17pf.s[19]++;return f(acc);},seminars));cov_1lkuiw17pf.s[20]++;callback(null,transformedSeminars);}});};};};};/**
 *  Filtre les séminaires avant une date particulière.
 *
 *  Si la date n'est pas fournise, on renvoie le tableau initial.
 *
 *  @param {Object} query - Objet avec le champ 'query.from'
 *  @param {Array} seminars - Tableau de séminaires à filtrer
 *  @returns {Array} Tableau de séminaires potentiellement filtré
 */cov_1lkuiw17pf.s[21]++;const filterSeminarsByFromDate=query=>{cov_1lkuiw17pf.f[7]++;cov_1lkuiw17pf.s[22]++;return seminars=>{cov_1lkuiw17pf.f[8]++;cov_1lkuiw17pf.s[23]++;if((cov_1lkuiw17pf.b[3][0]++,query!==undefined)&&(cov_1lkuiw17pf.b[3][1]++,query.from!==undefined)){cov_1lkuiw17pf.b[2][0]++;cov_1lkuiw17pf.s[24]++;return seminars.filter(s=>{cov_1lkuiw17pf.f[9]++;cov_1lkuiw17pf.s[25]++;return s.date>query.from;});}else{cov_1lkuiw17pf.b[2][1]++;cov_1lkuiw17pf.s[26]++;return seminars;}};};/**
 *  Trie les séminaires selon un champ et un ordre particulier.
 *
 *  Si le champ et/ou l'ordre n'est pas fournis, on renvoie le tableau initial.
 *
 *  @param {Object} query - Objet avec le champ 'query.sort.field' et 'query.sort.order'
 *  @param {Array} seminars - Tableau de séminaires à filtrer
 *  @returns {Array} Tableau de séminaires potentiellement trié
 */cov_1lkuiw17pf.s[27]++;const sortSeminars=query=>{cov_1lkuiw17pf.f[10]++;cov_1lkuiw17pf.s[28]++;return seminars=>{cov_1lkuiw17pf.f[11]++;const canSortByField=(cov_1lkuiw17pf.s[29]++,(cov_1lkuiw17pf.b[4][0]++,query!==undefined)&&(cov_1lkuiw17pf.b[4][1]++,query.sort!==undefined)&&(cov_1lkuiw17pf.b[4][2]++,query.sort.field!==undefined)&&((cov_1lkuiw17pf.b[4][3]++,query.sort.order==='ASC')||(cov_1lkuiw17pf.b[4][4]++,query.sort.order==='DESC')));cov_1lkuiw17pf.s[30]++;if(canSortByField){cov_1lkuiw17pf.b[5][0]++;cov_1lkuiw17pf.s[31]++;return seminars.sort((s1,s2)=>{cov_1lkuiw17pf.f[12]++;cov_1lkuiw17pf.s[32]++;return compare(query.sort.order)(s1.date)(s2.date);});}else{cov_1lkuiw17pf.b[5][1]++;cov_1lkuiw17pf.s[33]++;return seminars;}};};/**
 *  Fonction de comparaison entre deux valeurs et un ordre.
 *
 *  @param {string} order - Valeurs ASC ou DESC
 *  @param v1 - Première valeur
 *  @param v2 - Deuxième valeur
 *  @returns {int} Valeur de -1, 0 ou 1 selon le paramètre order
 */cov_1lkuiw17pf.s[34]++;const compare=order=>{cov_1lkuiw17pf.f[13]++;cov_1lkuiw17pf.s[35]++;return v1=>{cov_1lkuiw17pf.f[14]++;cov_1lkuiw17pf.s[36]++;return v2=>{cov_1lkuiw17pf.f[15]++;cov_1lkuiw17pf.s[37]++;if(order==='ASC'){cov_1lkuiw17pf.b[6][0]++;cov_1lkuiw17pf.s[38]++;return v1<v2?(cov_1lkuiw17pf.b[7][0]++,-1):(cov_1lkuiw17pf.b[7][1]++,v1>v2?(cov_1lkuiw17pf.b[8][0]++,1):(cov_1lkuiw17pf.b[8][1]++,0));}else{cov_1lkuiw17pf.b[6][1]++;cov_1lkuiw17pf.s[39]++;if(order==='DESC'){cov_1lkuiw17pf.b[9][0]++;cov_1lkuiw17pf.s[40]++;return v1<v2?(cov_1lkuiw17pf.b[10][0]++,1):(cov_1lkuiw17pf.b[10][1]++,v1>v2?(cov_1lkuiw17pf.b[11][0]++,-1):(cov_1lkuiw17pf.b[11][1]++,0));}else{cov_1lkuiw17pf.b[9][1]++;cov_1lkuiw17pf.s[41]++;return 0;}}};};};cov_1lkuiw17pf.s[42]++;module.exports=fs=>{cov_1lkuiw17pf.f[16]++;cov_1lkuiw17pf.s[43]++;return{getSeminars:getSeminars(fs)};};